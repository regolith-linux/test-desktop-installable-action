# DO NOT EDIT THIS FILE MANUALLY
#
# This file is auto-generated and any manual changes will be overwritten, nightly.
#
# - to change this file: modify .github/templates/test-new-repo.tmpl
# - to add a new distro: modify main.go and add a new entry to `supportedDistros`
# - to add new codename: create a subfolder in corresponding distro folder

name: Test New Repository

on:
  workflow_dispatch:
  workflow_call:
  push:
    branches:
      - main

concurrency:
  group: ${{"{{"}} github.workflow {{"}}"}}-${{"{{"}} github.ref {{"}}"}}
  cancel-in-progress: true

jobs:
{{- range . -}}
  {{- $name := .Name -}}
  {{- range .Codes }}
  {{ $name }}-{{ . }}:
    runs-on: ubuntu-24.04
    if: "!contains(github.event.head_commit.message, '[ci skip]')"
    strategy:
      fail-fast: false
      matrix:
        stage: [experimental, unstable, testing, stable]
    env:
      apt-key-url: http://archive.regolith-desktop.com/regolith.key
      apt-repo-line: "deb [arch=amd64] http://archive.regolith-desktop.com/{{ $name }}/${{"{{"}} matrix.stage {{"}}"}} {{ . }} main"
      target-package: regolith-desktop
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ${{"{{"}} env.target-package {{"}}"}} ${{"{{"}} matrix.stage {{"}}"}} on {{ $name }} {{ . }}
        uses: ./test-desktop/{{ $name }}/{{ . }}
        with:
          apt-key-url: ${{"{{"}} env.apt-key-url {{"}}"}}
          apt-repo-line: ${{"{{"}} env.apt-repo-line {{"}}"}}
          target-package: ${{"{{"}} env.target-package {{"}}"}}
{{ end -}}
{{ end -}}
